En el desarrollo de proyectos de Machine Learning, no basta con que el c√≥digo funcione en el entorno local de un desarrollador. Para que un proyecto sea escalable, mantenible y reproducible ‚Äîobjetivos clave dentro del ciclo de vida de MLOps ‚Äî es fundamental contar con una buena estrategia de **empaquetado y gesti√≥n de dependencias**.

El **empaquetado** convierte un proyecto en una unidad instalable, facilitando su distribuci√≥n, reutilizaci√≥n y ejecuci√≥n en distintos entornos (desarrollo, pruebas, producci√≥n). Por su parte, la gesti√≥n de dependencias garantiza que todas las librer√≠as y herramientas necesarias est√©n disponibles en versiones compatibles, evitando conflictos y fallos durante la ejecuci√≥n del pipeline.

En este contexto, herramientas modernas como `pyproject.toml` o `conda` cumplen un rol clave al facilitar la instalaci√≥n ordenada del proyecto y sus componentes.

## üéØ Objetivos de la pr√°ctica

Esta pr√°ctica tiene como finalidad que los estudiantes comprendan y apliquen los principios fundamentales del empaquetado de proyectos y la gesti√≥n de dependencias, elementos clave para garantizar la reproducibilidad, portabilidad y mantenibilidad de soluciones de Machine Learning en entornos reales.

Al finalizar esta pr√°ctica, el estudiante ser√° capaz de:

- Diferenciar el rol del empaquetado frente al entorno de ejecuci√≥n (conda/env) en el flujo de trabajo MLOps.
- Detectar errores comunes como el t√≠pico ModuleNotFoundError, y entender c√≥mo evitarlos mediante un empaquetado adecuado.
- Crear y configurar el archivo pyproject.toml para definir metadatos del proyecto y declarar sus dependencias.
- Instalar el proyecto como un paquete local y verificar que los m√≥dulos internos puedan ser importados correctamente.


## Trabajo Previo
Antes de abordar el empaquetado y la gesti√≥n de dependencias, se realizaron dos pasos fundamentales que sientan las bases para un flujo de trabajo robusto en MLOps:

1. **Estructura del Proyecto con Cookiecutter.**
Se utiliz√≥ la herramienta cookiecutter para generar una estructura de proyecto estandarizada, que incluye:

    - Separaci√≥n clara entre c√≥digo fuente (src/), datos (data/) y modelos (models/) .
    - Archivos auxiliares como .gitignore, README.md, y carpetas para reportes (reports/).

    Esta estructura facilita la colaboraci√≥n, el versionado y la escalabilidad del proyecto.

2. **Creaci√≥n del Entorno de Ejecuci√≥n.**
Se defini√≥ y cre√≥ un entorno virtual con Conda, especificando:

    - La versi√≥n de Python adecuada (por ejemplo, python=3.12).
    - Dependencias base como pandas, scikit-learn, cookiecutter, entre otras.
    - Posible inclusi√≥n del entorno en un archivo environment.yml para facilitar su recreaci√≥n.

    Este entorno garantiza que todos los participantes trabajen bajo las mismas condiciones de ejecuci√≥n, evitando errores relacionados con diferencias de versiones o paquetes.

## Empaquetado vs entorno: entendiendo sus roles en MLOps
El **empaquetado** y la **configuraci√≥n del entorno** son dos componentes fundamentales pero complementarios en un proyecto de Machine Learning dentro del ciclo de vida MLOps:

| Aspecto           | Empaquetado (`pyproject.toml`)                                                 | Entorno de Ejecuci√≥n (`conda`, `env`)                                             |
| ----------------- | ------------------------------------------------------------------------------ | --------------------------------------------------------------------------------- |
| ¬øQu√© es?          | Descripci√≥n del **proyecto y su instalaci√≥n** como paquete de Python           | Definici√≥n de las **librer√≠as, versiones y dependencias** para ejecutar el c√≥digo |
| ¬øQu√© resuelve?    | Facilita la distribuci√≥n e instalaci√≥n del c√≥digo como un m√≥dulo reutilizable. | Garantiza reproducibilidad y compatibilidad del entorno.                          |
| ¬øQui√©n lo usa?    | Otros desarrolladores o sistemas que consumen el proyecto.                     | T√∫ y tu equipo, durante desarrollo, entrenamiento o pruebas.                      |
| Archivo principal | `pyproject.toml` o antes `setup.py` + `setup.cfg`                              | `environment.yml`, `requirements.txt`, o comandos `conda`                         |

## üí• Error com√∫n: `ModuleNotFound` al ejecutar un script del proyecto

Para ilustrar un problema com√∫n en proyectos mal configurados, ejecutaremos el script `GetData.py`, cuya funci√≥n es obtener datos desde una fuente externa.

Este script importa otros m√≥dulos del mismo proyecto, como por ejemplo:

```bash
from app_logging import logging
```

Sin embargo, si intentamos ejecutarlo directamente con (o desde VS Code):

```bash
python src/data_eng/GetData.py
```

Es muy probable que obtengamos un error como:

```bash
ModuleNotFoundError: No module named 'app_logging'
```

‚ùì ¬øPor qu√© ocurre este error?

Este error ocurre porque Python no reconoce autom√°ticamente la ra√≠z del proyecto ni las rutas relativas a otros m√≥dulos internos cuando se ejecuta un archivo de forma directa. Si el empaquetado del proyecto no est√° configurado correctamente (por ejemplo, sin un `pyproject.toml`, `setup.py`, o sin a√±adir el proyecto al `PYTHONPATH`), Python no sabe c√≥mo resolver los imports relativos a la estructura del proyecto.

Adem√°s, en muchos casos, el desarrollador principal **puede haber configurado su entorno de desarrollo (IDE)** ‚Äîcomo PyCharm o VSCode‚Äî para que funcione solo en su m√°quina, estableciendo manualmente el int√©rprete o la carpeta ra√≠z. Esto **no garantiza que el proyecto funcione correctamente en otros entornos o m√°quinas**.


## Empaquetar el proyecto como un m√≥dulo Python

Para garantizar que todos los m√≥dulos internos del proyecto se puedan importar correctamente ‚Äîsin depender de configuraciones espec√≠ficas del entorno o del IDE‚Äî es necesario **empaquetar el proyecto como un m√≥dulo Python instalable**.
Esto se logra definiendo un archivo `pyproject.toml` (recomendado por los est√°ndares modernos de Python) o, alternativamente, un `setup.py`, donde se describe la informaci√≥n del proyecto y sus dependencias.

1. Crear el archivo `pyproject.toml` en la ra√≠z del proyecto:

    ```bash
    [build-system]
    requires = ["setuptools", "wheel"]
    build-backend = "setuptools.build_meta"

    [project]
    name = "MLOPS-Project"
    version = "0.1.0"
    authors = [{name = "Tu Nombre", email = "tu@correo.com"}]
    description = "Proyecto de predicci√≥n de costos en cadena de suministro"
    requires-python = ">=3.12"
    dynamic = ["dependencies"]

    [tool.setuptools.packages.find]
    where = ["src"]

    [tool.setuptools.dynamic]
    dependencies = {file = ["requirements.txt"]}
    ```

    !!! note "Nota"
        Para que `setuptools` encuentre los paquetes Python dentro de `src/`, debes indic√°rselo expl√≠citamente con esta l√≠nea en el archivo `pyproject.toml`.
        
        ```bash  
        [tool.setuptools.packages.find]
        where = ["src"]
        ```

2. Instala tu proyecto en modo editable. Usa el siguiente comando desde la ra√≠z del proyecto: 

    ```bash  
    pip install -e .
    ```

    Esto permitir√° que cualquier script dentro del proyecto pueda importar otros m√≥dulos internos sin necesidad de hacks o configuraci√≥n especial en el IDE.
