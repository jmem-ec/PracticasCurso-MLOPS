En esta pr√°ctica trabajaremos con **Git** y **GitHub** para simular un entorno colaborativo en el desarrollo de un proyecto de *Machine Learning para la Predicci√≥n de Precios en Art√≠culos de Consignaci√≥n* (ver detalles en [AI/ML canvas](../negocio/p4.md)). Cada estudiante trabajar√° con su propia copia del repositorio inicial, desarrollar√° funcionalidades en una rama independiente y colaborar√° con sus compa√±eros para integrar esos cambios al proyecto principal.

Es importante destacar que la colaboraci√≥n en proyectos de programaci√≥n requiere una forma de trabajo organizada sobre una misma base de c√≥digo. Para lograrlo, se utilizan los **sistemas de control de versiones**, y Git es uno de los m√°s utilizados en la actualidad.

Git permite registrar de forma clara:

- Qui√©n hizo un cambio en el c√≥digo.
- Cu√°ndo se realiz√≥ ese cambio.
- Qu√© se modific√≥ exactamente.

Estas capacidades facilitan el trabajo en equipo, permiten mantener un historial completo de cambios y hacen posible experimentar sin poner en riesgo la versi√≥n principal del proyecto.

Para profundizar m√°s en el uso de Git, puedes consultar el [libro oficial de Git](https://git-scm.com/book/es/v2) o explorar tutoriales interactivos disponibles en l√≠nea.

## Git vs GitHub

Es fundamental distinguir entre **Git** y **GitHub**:

- **Git** es la herramienta de control de versiones.
- **GitHub** es una plataforma web que permite alojar repositorios Git, colaborar con otros desarrolladores y revisar cambios desde una interfaz gr√°fica.

Aunque GitHub es la plataforma m√°s popular, tambi√©n existen otras alternativas como **[GitLab](https://about.gitlab.com)**, **[Bitbucket](https://bitbucket.org/product/)** o servidores privados.

## üéØ Objetivos

Al finalizar esta pr√°ctica, deber√°s ser capaz de:

- Clonar y configurar correctamente un repositorio remoto de GitHub.
- Crear y trabajar en ramas para desarrollar en paralelo.
- Subir y sincronizar tus cambios con el repositorio remoto.
- Resolver conflictos de integraci√≥n cuando existan.

## üßπ Limpieza de Entornos Conda No Utilizados

A lo largo de las pr√°cticas anteriores, se han introducido y aplicado los conceptos fundamentales para desarrollar un proyecto de Machine Learning de forma profesional, incluyendo la creaci√≥n de entornos virtuales, la gesti√≥n de dependencias y la organizaci√≥n del c√≥digo. Estos entornos han sido clave para asegurar la reproducibilidad y el aislamiento de cada fase del desarrollo.

Sin embargo, como resultado del trabajo pr√°ctico, es probable que se hayan generado varios entornos Conda que ya no ser√°n utilizados en las siguientes etapas del proyecto. Estos entornos contin√∫an ocupando espacio en disco y consumiendo recursos del sistema, aunque no est√©n en uso.

Por este motivo, se recomienda **eliminar los entornos que ya no se necesitan**. Esta es una pr√°ctica saludable para mantener tu sistema limpio, organizado y con espacio disponible, especialmente cuando trabajas con m√∫ltiples proyectos que requieren distintos entornos.

Adem√°s, la limpieza regular de entornos ayuda a evitar confusiones y errores derivados del uso accidental de entornos obsoletos.

#### üõ†Ô∏è Tarea
Responde las siguientes preguntas en la plataforma virtual:

- ¬øC√≥mo listar los entornos existentes?
- ¬øC√≥mo conocer todos los entornos creados y su ubicaci√≥n?
- ¬øC√≥mo conocer el entorno activo?
- ¬øC√≥mo eliminar un entorno que ya no usas?

Usando esta informacion puedes eliminar los entornos:

- mi_entorno
- mi_entorno_copia
- mlops_env

üîç Consejo adicional

Despu√©s de eliminar entornos, tambi√©n puedes liberar espacio limpiando paquetes en cach√© con:
      ```bash
      conda clean --all
      ```

Este comando:

- Elimina paquetes descargados que ya no se usan.
- Borra archivos de instalaci√≥n temporales.
- Libera espacio ocupado por versiones antiguas.

‚ö†Ô∏è Revisa lo que se va a eliminar antes de aceptar: te pedir√° confirmaci√≥n.

## Inicio del Proyecto
Se asume que el **responsable del proyecto** ya ha iniciado la configuraci√≥n inicial, ejecutando tareas previas como la i) definici√≥n del entorno de paquetes y librer√≠as, ii) la estructuraci√≥n del c√≥digo del proyecto (seg√∫n lo trabajado en las pr√°cticas [Creaci√≥n del Entorno Virtual](../entorno/p6.md) y [Estructura del Proyecto](../entorno/p5.md)) y iii) la implementaci√≥n de algunas etapas clave del proceso de ingenier√≠a de datos, como la **ingesta**, **limpieza** y **etiquetado de los datos** necesarios para entrenar el modelo de predicci√≥n. Con esta base establecida, el proyecto ha sido compartido con los colaboradores para continuar con su implementaci√≥n de forma colaborativa.


## Escenario

En esta pr√°ctica se simula una colaboraci√≥n entre dos personas trabajando sobre un mismo proyecto de *Machine Learning*, utilizando **Git** y **GitHub** como herramientas de control de versiones y coordinaci√≥n.

### Roles

- **Persona A** ser√° responsable de desarrollar un script que, a partir de un archivo de datos previamente procesado (en el que ya se han eliminado los valores at√≠picos, los datos nulos y los faltantes), realice la divisi√≥n del conjunto de datos en entrenamiento y prueba.

- **Persona B** trabajar√° en paralelo desarrollando un script independiente que utilice los datos ya divididos para entrenar y validar un modelo de *Machine Learning*.

Cada persona trabajar√° en su **propia rama de desarrollo**, y al finalizar sus tareas, integrar√°n sus aportes al proyecto principal mediante **GitHub**, siguiendo buenas pr√°cticas de colaboraci√≥n y control de versiones.

## Requisitos previos: para cada persona

Antes de comenzar la pr√°ctica, aseg√∫rate de cumplir con los siguientes requisitos. Si a√∫n no los tienes listos, aqu√≠ te explicamos c√≥mo cumplirlos:

### 1. Tener una cuenta de GitHub

**Pasos para crear una cuenta:**

- Ingresa a [https://github.com](https://github.com)
- Haz clic en **Sign up** (Registrarse).
- Completa los datos solicitados:
      - Nombre de usuario
      - Correo electr√≥nico
      - Contrase√±a segura
- Sigue las instrucciones para verificar tu correo.
- Puedes elegir el **plan gratuito (Free plan)** para comenzar.

Una vez creada tu cuenta, podr√°s clonar repositorios, crear ramas, hacer cambios y colaborar con otras personas.

### 2. Tener Git instalado

**Pasos para instalar Git:**

   - Abre una terminal y ejecuta los siguientes comandos:

      ```bash
      sudo apt update
      sudo apt install git
      ```

   - Verifica la instalaci√≥n con:
    
      ```bash
      git ‚Äì-version
      ```

### 3. Configurar acceso remoto a GitHub [opcional]

Aunque este requisito es **opcional**, se recomienda cumplirlo para facilitar el trabajo con Git. Su principal ventaja es que evita tener que ingresar tu usuario y contrase√±a cada vez que realizas un `git push`. Para lograrlo, puedes configurar una **conexi√≥n segura** con GitHub utilizando una llave SSH.

!!! note "IMPORTANTE"
      Si decides no usar el **m√©todo de conexi√≥n segura** debes configurar Git para usar tu usuario de GitHub. De esta forma `git` sabr√° quien es la persona autor de los `git commit`. El resto de pasos **no son necesarios**.

      ```bash
      git config --global user.name "Tu Nombre Usuario"
      git config --global user.email "tu-email@ejemplo.com"
      ```



- Verificar si ya tienes una clave SSH. Abre tu terminal y ejecuta:
      ```bash
      ls ~/.ssh
      ```
      Si ves archivos como id_rsa y id_rsa.pub o id_ed25519, ya tienes una clave SSH. Si no, crea una.


- Generar una nueva llave SSH:

      ```bash
      ssh-keygen -t rsa -b 4096 -C "tucorreo@example.com"
      ```
      Ingrese el nombre del archivo para grabar la clave o presione ENTER para usar el nombre por omisi√≥n. Puede omitir el ingreso de una passphrase (o frase de paso).

- Mostrar la clave p√∫blica:

      ```bash
      cat ~/.ssh/id_rsa.pub
      ```
      
- Copiar la clave y agregarla en GitHub:

      - Ir a Settings ‚Üí SSH and GPG keys ‚Üí New SSH Key.
      - Pegar la clave en el campo correspondiente

- Configurar Git para usar tu usuario de GitHub

      ```bash
      git config --global user.name "Tu Nombre Usuario"
      git config --global user.email "tu-email@ejemplo.com"
      ```

- Probar conexi√≥n

      ```bash
      ssh -T git@github.com
      ```
      **Si todo est√° bien, ver√°s algo como**:

      The authenticity of host '[ssh.github.com]:443 ([140.82.112.36]:443)' can't be established.
      XXXXXXX key fingerprint is SHA256:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX.

      This key is not known by any other names.

      Are you sure you want to continue connecting (yes/no/[fingerprint])? yes

      Hi tu_usuario! You've successfully authenticated.

      **En caso de no poder conectarse** y obtener un mensaje como este :

      ssh: connect to host github por un error de timed out port 22: Connection timed out. 

      - Puedes configurar Git a usar otro puerto (Ej. 443) para SSH. 
      - Edita (o crea) el archivo ~/.ssh/config:

      ```bash
      nano ~/.ssh/config
      ```

      - Agrega este contenido

      ```bash
      Host github.com
      Hostname ssh.github.com
      Port 443
      User git
      ```

      - Guarda y prueba otra vez.

      ```bash
      ssh -T git@github.com
      ```

!!! note "IMPORTANTE"
      Por omisi√≥n, el acceso remoto en Git a plataformas como GitHub, GitLab o Bitbucket es mediante **HTTPS**. Esto ocurre porque:

      - Es m√°s sencillo de configurar inicialmente (no requiere claves SSH).
      - Cualquier usuario con nombre de usuario y contrase√±a (o token personal) puede clonar un repositorio.

      Sin embargo, **SSH es la opci√≥n recomendada** para mayor seguridad y comodidad, especialmente si trabajas frecuentemente con Git, ya que:

      - Evita tener que introducir el usuario/contrase√±a o token en cada operaci√≥n.
      - Utiliza autenticaci√≥n basada en claves, que es m√°s segura

      Para cambiar el acceso remoto de **HTTPS a SSH**, debes actualizar la URL del repositorio remoto **una sola vez** con el siguiente comando:

      ```bash
      git remote set-url origin git@github.com:TU-USUARIO/Proyecto-MLOPS.git
      ```
      
      Esto configura el repositorio para usar autenticaci√≥n SSH en lugar de HTTPS en futuras operaciones como `git push` o `git pull`.


## Configuraci√≥n del repositorio de equipo

Uno de los estudiantes (**Persona A** o **Persona B**) realizar√° un **fork** del repositorio base proporcionado por el docente (**Responsable del Proyecto**). Un fork en GitHub es una copia de un repositorio que se crea en tu propia cuenta. Te permite experimentar y trabajar en un proyecto sin afectar el original.

### Pasos para hacer el fork:

1. Ir al repositorio original (del docente) en GitHub [https://github.com/jmem-ec/Proyecto-MLOPS-Base](https://github.com/jmem-ec/Proyecto-MLOPS-Base). 

2. Hacer clic en el bot√≥n **"Fork"** en la parte superior derecha.
3. GitHub crear√° una copia del repositorio en la cuenta de la persona, por ejemplo: 

      `https://github.com/Persona_A/Proyecto-MLOPS`

      Se recomienda cambiar el nombre del repositorio de **Proyecto-MLOPS-Base** a **Proyecto-MLOPS**, ya que este repositorio servir√° como base principal para el desarrollo del proyecto de MLOps a lo largo de todo el curso.

Esta persona se convertir√° en el "due√±o" del fork, es decir, el responsable principal de esta copia del proyecto. A partir de aqu√≠:

- Debe **invitar a sus compa√±eros como colaboradores** del repositorio:

      - Ir a **Settings > Collaborators**
      - Hacer clic en **"Add collaborator"**
      - Ingresar los nombres de usuario de GitHub de los compa√±eros para que puedan clonar, crear ramas, hacer cambios y subirlos

> üìù **Nota explicativa**:  
> El objetivo de realizar un fork y no empezar desde cero es aprovechar una base inicial de c√≥digo ya estructurada, lo cual es muy com√∫n en proyectos reales. Por ejemplo, un equipo puede comenzar a desarrollar un sistema de Machine Learning a partir de un repositorio de prueba, una plantilla anterior o incluso un proyecto experimental del responsable t√©cnico (en este caso, el docente).  
> A partir de ese punto de partida, los estudiantes comienzan a construir, adaptar y colaborar en su propia versi√≥n del proyecto.

## Clonar el repositorio del equipo

Para comenzar a trabajar, cada estudiante ‚Äî**incluido quien haya realizado el fork**‚Äî debe clonar en su equipo local el repositorio que se gener√≥ a partir del fork.
Este ser√° su repositorio de trabajo a lo largo del curso.

```bash
git clone https://github.com/Persona_A/Proyecto-MLOPS
cd Proyecto-MLOPS
```

## Crear y activar el entorno `conda`

Cada estudiante debe crear y activar el entorno `conda` a partir del archivo `environment.yml`

#### üõ†Ô∏è Tarea

- ¬øPuedes identificar los cambios realizados sobre la plantilla base de MLOps (utilizada en la pr√°ctica [Estructura del Proyecto](../entorno/p6.md)) que han sido implementados por el responsable en este nuevo proyecto?
- Al revisar el c√≥digo implementado, ¬øcu√°l es el nombre del archivo que contiene los datos fuente utilizados para el entrenamiento del modelo?
- ¬øEl entorno creado en que ruta est√° almacenado?


## Tareas del equipo de desarrollo

Una vez que cada persona del equipo ha clonado y activado el entorno del proyecto, debe ejecutar las siguientes tareas de implementaci√≥n de forma paralela. Cada integrante trabajar√° en su propia rama para luego integrar los cambios al repositorio principal.

### Persona A: Divisi√≥n de datos

1. **Crear y cambiar a una nueva rama**:

      ```bash
      git checkout -b division-datos
      ```

2. Agregar el archivo [`stage4_splitting.py`](recursos/stage4_splitting.py) en la carpeta  `src/data_eng`.

      üõ†Ô∏è Tarea

      Responda algunas preguntas en la plataforma virtual.

3. Guardar los cambios y subirlos al repositorio remoto:

      ```bash
      git add src/data_eng/stage4_splitting.py
      git commit -m "Agrega script para dividir datos en train/test"
      git push origin division-datos
      ```

### Persona B: Entrenamiento del Modelo

1. **Crear y cambiar a una nueva rama**:

      ```bash
      git checkout -b entrenamiento-modelo
      ```

2. Agregar el archivo [`stage1-2_train-evaluate.py`](recursos/stage1-2_train-evaluate.py) en la carpeta  `src/model_eng/model1`.

      üõ†Ô∏è Tarea
      
      Responda algunas preguntas en la plataforma virtual.

3. Guardar los cambios y subirlos al repositorio remoto:

      ```bash
      git add src/model_eng/model1/stage1-2_train-evaluate.py
      git commit -m "Agrega script de entrenamiento y validaci√≥n del modelo"
      git push origin entrenamiento-modelo
      ```
      
### Persona A √≥ B: Integrar ramas en `main`

Una vez que las tareas de cada persona est√°n completas y no contiene errores, se debe integrar el trabajo en la rama principal (`main`). Esto lo puede hacer una persona responsable del proyecto o el equipo siguiendo estos pasos:

```bash
git checkout main
git pull origin main
git merge division-datos
git merge entrenamiento-modelo
git push origin main
```

### Persona A √≥ B: Predicci√≥n del Modelo

1. **Crear y cambiar a una nueva rama**:

      ```bash
      git checkout -b prediccion-modelo
      ```

2. Agregar el archivo [`stage3_prediction.py`](recursos/stage3_prediction.py) en la carpeta  `src/model_eng/model1`.

      üõ†Ô∏è Tarea
      
      Responda algunas preguntas en la plataforma virtual.

3. Guardar los cambios y subirlos al repositorio remoto:

      ```bash
      git add src/model_eng/model1/stage3_prediction.py
      git commit -m "Agrega script de predicci√≥n del modelo"
      git push origin prediccion-modelo
      ```

4. Integrar el trabajo en la rama principal (`main`).

### Actualizar el c√≥digo local de cada persona

Una vez que las ramas han sido integradas en la rama principal del repositorio (main), cada integrante del equipo debe actualizar su copia local para trabajar con la versi√≥n m√°s reciente del proyecto. A continuaci√≥n, se indican los pasos recomendados para hacerlo correctamente.

1. Cambiar a la rama `main` (si a√∫n no est√°n en ella)

      ```bash
      git checkout main
      ```

2. Actualizar su rama `main` desde el repositorio remoto:

      ```bash
      git pull origin main
      ```

Esto descargar√° e integrar√° todos los cambios m√°s recientes realizados por otros (como las integraciones de ramas que hiciste).